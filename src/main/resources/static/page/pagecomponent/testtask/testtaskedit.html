<link rel="stylesheet" type="text/css"
      href="/page/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css"
      href="/page/bootstrap/css/bootstrap-table.css">
<link rel="stylesheet" type="text/css"
      href="/page/bootstrap/css/jquery-ui.css">
<link rel="stylesheet" type="text/css"
      href="/page/bootstrap/css/bootstrap-datetimepicker.min.css">
<link rel="stylesheet" type="text/css"
      href="/page/bootstrap/css/bootstrap-table.css">

<script type="text/javascript"
        src="/page/js/jquery.min.js"></script>
<script type="text/javascript"
        src="/page/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript"
        src="/page/js/jquery-ui.min.js"></script>
<script type="text/javascript"
        src="/page/js/bootstrap-table.min.js"></script>
<script type="text/javascript"
        src="/page/js/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript" src="/page/layer/layer.js"></script>
<script type="text/javascript"
        src="/page/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript"
        src="/page/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script type="text/javascript"
        src="/page/js/bootstrap-table.min.js"></script>
<script type="text/javascript"
        src="/page/js/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript" src="/page/js/common.js"></script>

<script>

    $(function(){
        showDetail();
        datePickerInit();
        userOperationRecordTableInit();
    });


    function userOperationRecordTableInit(){
        $('#userOperationRecordTable').bootstrapTable({
            columns:[{
                field : 'name',
                title : '测试任务名称'
            },{
                field : 'projectName',
                title : '关联项目'
            },{
                field : 'requirementName',
                title : '关联需求'
            },{
                field : 'owner',
                title : '创建者'
            },{
                field : 'begin',
                title : '开始时间',
                formatter: function (value, row, index) {
                    if (row.begin != null) {
                        return new Date(row.begin).format('yyyy-MM-dd');
                    }
                    return null;
                }
            },{
                field : 'end',
                title : '结束时间',
                formatter: function (value, row, index) {
                    if (row.end != null) {
                        return new Date(row.end).format('yyyy-MM-dd');
                    }
                    return null;
                }
            },{
                field : 'status',
                title : '状态',
                formatter: function (value, row, index) {
                    var s = row.status;
                    if (s == 'wait') {
                        return '待开始';
                    } else if (s == 'done') {
                        return '已关闭';
                    } else if (s == 'doing') {
                        return '进行中';
                    }
                }
            },{
                field : 'openedName',
                title : '激活人'
            },{
                field : 'assignedByName',
                title : '指派给'
            },{
                field : 'finishedName',
                title : '完成人'
            },{
                field : 'closedName',
                title : '关闭人'
            }],
            url : '/testtask/getTestTaskRecords',
            method : 'GET',
            queryParams : queryParams,
            sidePagination : "server",
            dataType : 'json',
            pagination : true,
            pageNumber : 1,
            pageSize : 10,
            pageList : [ 5, 10, 25, 50, 100 ],
            clickToSelect : false
        });
    }

    // 分页查询参数
    function queryParams(params) {
        var temp = {
            limit : params.limit,
            offset : params.offset
        };
        return temp;
    }

    // 日期选择器初始化
    function datePickerInit(){
        $('.form_date').datetimepicker({
            format:'yyyy-mm-dd',
            language : 'zh-CN',
            startDate : new Date(),
            //endDate : new Date(),
            weekStart : 1,
            todayBtn : 1,
            autoClose : 1,
            todayHighlight : 1,
            startView : 2,
            forceParse : 0,
            minView:2
        });
    }

    function showDetail() {
        var testtaskId = parent.$('#detail_id').val();

        var entity = {};
        entity.id = testtaskId;

        <!--loding-->
        var load = layer.load();
        $.ajax({
            type: "POST",
            url: "/testtask/showDetail",
            headers: {
                "content-Type": "application/json"
            },
            data: JSON.stringify(entity),
            success: function (data) {
                layer.close(load);
                if (data.code == 200) {
                    fillingDetailByResult(data.result);
                } else {
                    layer.msg(data.message);
                }
            },
            error: function (data) {
                layer.msg(data.responseText);
            }
        });
    }

    function fillingDetailByResult(result) {
        setById('name',result.name);
        setById('projectName',result.projectName);
        setById('requirementName',result.requirementName);
        setById('begin',new Date(result.begin).format("yyyy-MM-dd"));
        setById('end',new Date(result.end).format("yyyy-MM-dd"));
        setById('status',getStatusDesc(result.status));
        setById('assignedByName',result.assignedByName);
        setById('description',result.description);
    }

    function getStatusDesc(s) {
        if (s == 'wait') {
            return '待开始';
        } else if (s == 'done') {
            return '已关闭';
        } else if (s == 'doing') {
            return '进行中';
        }
    }

    function setById(id,value) {
        $('#' + id).val(value);
    }
</script>

<div class="panel panel-default">
    <div class="panel-body">
        <div class="row">
            <div class="col-md-3">
                <label class="form-label">测试任务名称：</label>
                <input type="text" id="name" class="form-control" disabled = "disabled">
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">关联项目：</label>
                <input type="text" id="projectName" class="form-control" disabled = "disabled">
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">关联需求：</label>
                <input type="text" id="requirementName" class="form-control" disabled = "disabled">
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">开始时间：</label>
                <input class="form_date form-control" value="" id="begin" name="begin">
                <!--<input type="text" id="begin" class="form-control" >-->
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">结束时间：</label>
                <input class="form_date form-control" value="" id="end" name="end">
                <!--<input type="text" id="end" class="form-control" >-->
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">状态：</label>
                <input type="text" id="status" class="form-control" disabled = "disabled">
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">测试任务描述：</label>
                <input type="text" id="description" class="form-control" >
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label class="form-label">指派给：</label>
                <input type="text" id="assignedByName" class="form-control" >
            </div>
        </div>

        <div class="row" style="margin-top:25px">
            <div class="col-md-12">
                <table class="table table-striped" id="userOperationRecordTable"></table>
            </div>
        </div>
    </div>
</div>
